<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Dashboard | Ubuntu Explorer</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="images/ubuntuexploreroutline.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Poppins', sans-serif;
        }
        
        .recommendation-card {
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
        }
        
        .recommendation-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.1);
        }
        
        .ubuntu-pattern {
            background-image: url('https://www.transparenttextures.com/patterns/black-linen.png');
            background-color: #1e40af;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="ubuntu-pattern text-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0 flex items-center">
                        <img class="h-8 w-auto" src="images/ubuntuexploreroutline.png" alt="Ubuntu Explorer Logo">
                        <span class="ml-2 text-white font-bold">Ubuntu Explorer</span>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="countries.html" class="text-white hover:text-gray-200 px-3 py-2 rounded-md text-sm font-medium">
                        <i class="fas fa-globe mr-1"></i> Explore Countries
                    </a>
                    <div class="relative">
                        <button class="flex items-center text-white hover:text-gray-200 px-3 py-2 rounded-md text-sm font-medium">
                            <div class="w-8 h-8 bg-white rounded-full flex items-center justify-center mr-2">
                                <span id="userInitials" class="text-blue-600 font-semibold text-sm"></span>
                            </div>
                            <span id="userName"></span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Welcome Section -->
        <div class="bg-white rounded-2xl shadow-lg p-8 mb-8">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold text-gray-800 mb-2">Welcome back, <span id="welcomeName"></span>! üåç</h1>
                    <p class="text-gray-600">Based on your preferences, we've curated personalized travel experiences for you.</p>
                </div>
                <div class="hidden md:block">
                    <div class="w-24 h-24 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center">
                        <i class="fas fa-suitcase-rolling text-white text-3xl"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- User Stats -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-xl p-6 shadow-md">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mr-4">
                        <i class="fas fa-map-marker-alt text-blue-600 text-xl"></i>
                    </div>
                    <div>
                        <h3 class="text-2xl font-bold text-gray-800" id="interestedCountries">0</h3>
                        <p class="text-gray-600 text-sm">Countries of Interest</p>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-md">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mr-4">
                        <i class="fas fa-dollar-sign text-green-600 text-xl"></i>
                    </div>
                    <div>
                        <h3 class="text-2xl font-bold text-gray-800" id="budgetRange">$0</h3>
                        <p class="text-gray-600 text-sm">Daily Budget</p>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-md">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center mr-4">
                        <i class="fas fa-heart text-purple-600 text-xl"></i>
                    </div>
                    <div>
                        <h3 class="text-2xl font-bold text-gray-800" id="travelStyle">-</h3>
                        <p class="text-gray-600 text-sm">Travel Style</p>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-md">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center mr-4">
                        <i class="fas fa-calendar text-orange-600 text-xl"></i>
                    </div>
                    <div>
                        <h3 class="text-2xl font-bold text-gray-800" id="tripDuration">-</h3>
                        <p class="text-gray-600 text-sm">Preferred Duration</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Personalized Recommendations -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Main Recommendations -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">
                        <i class="fas fa-star text-yellow-500 mr-2"></i>
                        Recommended for You
                    </h2>
                    <div id="recommendations" class="space-y-6">
                        <!-- Recommendations will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="space-y-6">
                <!-- Travel Goals -->
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">
                        <i class="fas fa-bullseye text-blue-600 mr-2"></i>
                        Your Travel Goals
                    </h3>
                    <div id="travelGoals" class="space-y-3">
                        <!-- Goals will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">
                        <i class="fas fa-rocket text-purple-600 mr-2"></i>
                        Quick Actions
                    </h3>
                    <div class="space-y-3">
                        <button class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg transition-colors">
                            <i class="fas fa-search mr-2"></i>
                            Find New Destinations
                        </button>
                        <button class="w-full bg-green-600 hover:bg-green-700 text-white py-3 px-4 rounded-lg transition-colors">
                            <i class="fas fa-route mr-2"></i>
                            Plan Trip Itinerary
                        </button>
                        <button class="w-full bg-orange-600 hover:bg-orange-700 text-white py-3 px-4 rounded-lg transition-colors">
                            <i class="fas fa-cog mr-2"></i>
                            Update Preferences
                        </button>
                    </div>
                </div>

                <!-- Budget Insights -->
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">
                        <i class="fas fa-chart-pie text-green-600 mr-2"></i>
                        Budget Insights
                    </h3>
                    <div id="budgetInsights" class="space-y-3">
                        <!-- Budget insights will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Load user preferences from localStorage
        const userPreferences = JSON.parse(localStorage.getItem('ubuntuExplorerUser')) || null;

        if (!userPreferences) {
            // Redirect to auth if no user data
            window.location.href = 'auth.html';
        } else {
            // Populate dashboard with user data
            initializeDashboard(userPreferences);
        }

        function initializeDashboard(preferences) {
            // Update user info
            const firstName = preferences.basic?.firstName || 'Traveler';
            const lastName = preferences.basic?.lastName || '';
            
            document.getElementById('userName').textContent = firstName;
            document.getElementById('welcomeName').textContent = firstName;
            document.getElementById('userInitials').textContent = (firstName.charAt(0) + (lastName.charAt(0) || '')).toUpperCase();

            // Update stats
            document.getElementById('interestedCountries').textContent = preferences.goals?.countries?.length || 0;
            document.getElementById('budgetRange').textContent = `$${preferences.budget?.budget || 0}`;
            document.getElementById('travelStyle').textContent = formatTravelStyle(preferences.travel?.travelStyle);
            document.getElementById('tripDuration').textContent = formatDuration(preferences.budget?.duration);

            // Generate recommendations
            generateRecommendations(preferences);
            
            // Populate travel goals
            populateTravelGoals(preferences.goals?.goals || []);
            
            // Generate budget insights
            generateBudgetInsights(preferences.budget);
        }

        function formatTravelStyle(style) {
            if (!style) return 'Not specified';
            return style.charAt(0).toUpperCase() + style.slice(1);
        }

        function formatDuration(duration) {
            const durations = {
                'weekend': '2-3 days',
                'week': '1 week',
                'extended': '1-2 weeks',
                'long': '3+ weeks'
            };
            return durations[duration] || 'Not specified';
        }

        function generateRecommendations(preferences) {
            const recommendations = [];
            const userCountries = preferences.goals?.countries || [];
            const travelStyle = preferences.travel?.travelStyle;
            const budget = parseInt(preferences.budget?.budget) || 150;

            // Country-specific recommendations based on user's interests
            userCountries.forEach(country => {
                const recommendation = getCountryRecommendation(country, travelStyle, budget);
                if (recommendation) {
                    recommendations.push(recommendation);
                }
            });

            // If no specific countries, provide general recommendations
            if (recommendations.length === 0) {
                recommendations.push(...getGeneralRecommendations(travelStyle, budget));
            }

            // Populate recommendations
            const container = document.getElementById('recommendations');
            container.innerHTML = recommendations.map(rec => `
                <div class="recommendation-card border border-gray-200 rounded-xl p-6 cursor-pointer" onclick="exploreCountry('${rec.country}')">
                    <div class="flex items-start">
                        <div class="w-16 h-16 bg-gradient-to-br ${rec.color} rounded-xl flex items-center justify-center mr-4 flex-shrink-0">
                            <span class="text-2xl">${rec.flag}</span>
                        </div>
                        <div class="flex-grow">
                            <h3 class="text-xl font-bold text-gray-800 mb-2">${rec.title}</h3>
                            <p class="text-gray-600 mb-3">${rec.description}</p>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center text-sm text-gray-500">
                                    <i class="fas fa-dollar-sign mr-1"></i>
                                    <span class="mr-4">${rec.budgetMatch}</span>
                                    <i class="fas fa-heart mr-1"></i>
                                    <span>${rec.styleMatch}</span>
                                </div>
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                    ${rec.matchPercentage}% match
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function getCountryRecommendation(country, style, budget) {
            const countryData = {
                'China': {
                    flag: 'üá®üá≥',
                    color: 'from-red-400 to-red-600',
                    title: 'Discover Ancient China',
                    description: 'Explore the Great Wall, Forbidden City, and modern Shanghai. Perfect for cultural enthusiasts.',
                    budgetMatch: budget > 80 ? 'Good fit' : 'Budget friendly',
                    styleMatch: style === 'culture' ? 'Perfect match' : 'Good match'
                },
                'Japan': {
                    flag: 'üáØüáµ',
                    color: 'from-pink-400 to-red-500',
                    title: 'Experience Japan',
                    description: 'From Tokyo\'s neon lights to Kyoto\'s temples. Blend of tradition and innovation.',
                    budgetMatch: budget > 120 ? 'Good fit' : 'Plan carefully',
                    styleMatch: style === 'culture' ? 'Perfect match' : 'Good match'
                },
                'Brazil': {
                    flag: 'üáßüá∑',
                    color: 'from-green-400 to-yellow-500',
                    title: 'Vibrant Brazil',
                    description: 'Amazon rainforest, Rio beaches, and Carnival culture. Adventure awaits!',
                    budgetMatch: budget > 70 ? 'Great value' : 'Budget friendly',
                    styleMatch: style === 'adventure' ? 'Perfect match' : 'Good match'
                },
                'Germany': {
                    flag: 'üá©üá™',
                    color: 'from-gray-400 to-yellow-500',
                    title: 'Historic Germany',
                    description: 'Castles, Christmas markets, and cutting-edge cities. Rich history and culture.',
                    budgetMatch: budget > 100 ? 'Good fit' : 'Mid-range',
                    styleMatch: style === 'culture' ? 'Perfect match' : 'Good match'
                },
                'Australia': {
                    flag: 'üá¶üá∫',
                    color: 'from-blue-400 to-orange-500',
                    title: 'Wild Australia',
                    description: 'Great Barrier Reef, Outback adventures, and vibrant cities like Sydney.',
                    budgetMatch: budget > 150 ? 'Good fit' : 'Premium destination',
                    styleMatch: style === 'adventure' ? 'Perfect match' : 'Good match'
                }
            };

            const data = countryData[country];
            if (data) {
                const matchPercentage = calculateMatchPercentage(country, style, budget);
                return { ...data, country, matchPercentage };
            }
            return null;
        }

        function getGeneralRecommendations(style, budget) {
            return [
                {
                    country: 'Thailand',
                    flag: 'üáπüá≠',
                    color: 'from-red-400 to-blue-500',
                    title: 'Discover Southeast Asia',
                    description: 'Great starting point for your travel journey. Affordable and diverse.',
                    budgetMatch: 'Budget friendly',
                    styleMatch: 'All styles',
                    matchPercentage: 85
                }
            ];
        }

        function calculateMatchPercentage(country, style, budget) {
            // Simple algorithm to calculate match percentage
            let score = 70; // Base score
            
            // Style matching
            if (style === 'culture' && ['China', 'Japan', 'Germany'].includes(country)) score += 15;
            if (style === 'adventure' && ['Brazil', 'Australia'].includes(country)) score += 15;
            if (style === 'relaxation' && ['Australia', 'Brazil'].includes(country)) score += 10;
            
            // Budget matching
            const countryBudgets = { 'China': 80, 'Japan': 120, 'Brazil': 70, 'Germany': 100, 'Australia': 150 };
            const countryBudget = countryBudgets[country] || 100;
            if (Math.abs(budget - countryBudget) < 30) score += 10;
            
            return Math.min(score, 95);
        }

        function populateTravelGoals(goals) {
            const goalIcons = {
                'education': 'fas fa-graduation-cap',
                'relaxation': 'fas fa-spa',
                'adventure': 'fas fa-mountain',
                'social': 'fas fa-users',
                'photography': 'fas fa-camera',
                'business': 'fas fa-briefcase'
            };

            const goalTexts = {
                'education': 'Education & Learning',
                'relaxation': 'Rest & Relaxation',
                'adventure': 'Adventure & Thrills',
                'social': 'Social Connection',
                'photography': 'Photography',
                'business': 'Business & Networking'
            };

            const container = document.getElementById('travelGoals');
            container.innerHTML = goals.map(goal => `
                <div class="flex items-center p-3 bg-gray-50 rounded-lg">
                    <i class="${goalIcons[goal] || 'fas fa-check'} text-blue-600 mr-3"></i>
                    <span class="text-gray-700">${goalTexts[goal] || goal}</span>
                </div>
            `).join('') || '<p class="text-gray-500 text-sm">No specific goals set</p>';
        }

        function generateBudgetInsights(budget) {
            const dailyBudget = parseInt(budget?.budget) || 150;
            const duration = budget?.duration || 'week';
            
            const durationDays = {
                'weekend': 3,
                'week': 7,
                'extended': 10,
                'long': 21
            };
            
            const days = durationDays[duration] || 7;
            const totalBudget = dailyBudget * days;
            
            const insights = [
                {
                    icon: 'fas fa-calculator',
                    text: `Total trip budget: $${totalBudget.toLocaleString()}`
                },
                {
                    icon: 'fas fa-bed',
                    text: `Accommodation: $${Math.round(dailyBudget * 0.4)}/night`
                },
                {
                    icon: 'fas fa-utensils',
                    text: `Food budget: $${Math.round(dailyBudget * 0.3)}/day`
                },
                {
                    icon: 'fas fa-ticket-alt',
                    text: `Activities: $${Math.round(dailyBudget * 0.3)}/day`
                }
            ];

            const container = document.getElementById('budgetInsights');
            container.innerHTML = insights.map(insight => `
                <div class="flex items-center text-sm">
                    <i class="${insight.icon} text-green-600 mr-3 w-4"></i>
                    <span class="text-gray-700">${insight.text}</span>
                </div>
            `).join('');
        }

        function exploreCountry(country) {
            window.location.href = `data.html?country=${encodeURIComponent(country)}`;
        }

        // Quick action handlers
        document.addEventListener('click', (e) => {
            if (e.target.closest('button')) {
                const button = e.target.closest('button');
                const text = button.textContent.trim();
                
                if (text.includes('Find New Destinations')) {
                    window.location.href = 'countries.html';
                } else if (text.includes('Update Preferences')) {
                    window.location.href = 'auth.html';
                } else if (text.includes('Plan Trip Itinerary')) {
                    alert('Trip planning feature coming soon!');
                }
            }
        });
    </script>
</body>
</html>
